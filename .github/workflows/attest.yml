name: Protocol Attestation

on:
  schedule:
    - cron: '0 */6 * * *'
  push:
    branches: [ main, 'claude/**' ]
    paths:
      - '**STEWARD.md'
      - 'steward/**'
      - 'setup.py'
  workflow_dispatch:

jobs:
  verify-agents:
    name: ðŸ›¡ï¸ Verify Agent Identities
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Steward Protocol
        run: |
          pip install -e .

      - name: ðŸ”Ž Verify Organization Identity (Strict)
        # Enforce cryptographic signature on the Root Identity
        run: |
          steward verify STEWARD.md --strict

      - name: ðŸ”Ž Verify Resident Agents
        # Verify all agents found in examples/
        run: |
          echo "Searching for STEWARD.md files in examples..."
          if find examples -name "STEWARD.md" -type f 2>/dev/null | grep -q .; then
            find examples -name "STEWARD.md" -type f | while read file; do
              echo ""
              echo "Verifying $file..."
              steward verify "$file" --strict
            done
          else
            echo "No STEWARD.md files found in examples/ (optional)"
          fi

      - name: âœ… Attestation Complete
        if: success()
        run: echo "âœ… All Agents compliant and cryptographically verified."
