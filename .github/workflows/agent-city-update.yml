name: "ğŸ›ï¸ Agent City Auto-Update"

on:
  schedule:
    - cron: "0 */6 * * *"  # Every 6 hours
  workflow_dispatch:

jobs:
  update_leaderboard:
    name: "ğŸ“Š Update Leaderboard"
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ğŸ Setup Python"
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: "ğŸ“¦ Install Dependencies"
        run: |
          pip install --upgrade pip
          pip install Pillow

      - name: "ğŸ“Š Collect Stats"
        run: |
          PYTHONPATH=. python3 agent-city/scripts/collect_stats.py

      - name: "ğŸ† Generate Leaderboard"
        run: |
          PYTHONPATH=. python3 agent-city/scripts/generate_leaderboard.py

      - name: "ğŸ¨ Render Dashboard"
        run: |
          PYTHONPATH=. python3 agent-city/scripts/render_dashboard.py

      - name: "ğŸ’¾ Commit Changes"
        run: |
          git config --global user.name "Agent City Bot"
          git config --global user.email "agent-city@steward.protocol"
          git add agent-city/stats/ agent-city/LEADERBOARD.md docs/agent-city/
          git commit -m "chore: Update Agent City stats [skip ci]" || echo "No changes to commit"
          git push
