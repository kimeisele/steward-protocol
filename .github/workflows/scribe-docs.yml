name: ðŸ“š SCRIBE - Auto-Generate Documentation

on:
  push:
    branches:
      - main
      - claude/*
    paths:
      - 'steward/system_agents/**'
      - 'scripts/**'
      - 'pyproject.toml'
      - 'agent_city.yaml'
      - 'steward.yaml'
  workflow_dispatch:

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    name: Generate Documentation with SCRIBE

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install jinja2 toml

      - name: ðŸš€ Generate all documentation (standalone)
        run: |
          python scripts/generate_docs.py

      - name: ðŸ“ Check for documentation changes
        id: check-changes
        run: |
          if git diff --quiet HEAD; then
            echo "status=clean" >> $GITHUB_OUTPUT
          else
            echo "status=changed" >> $GITHUB_OUTPUT
            git diff --name-only
          fi

      - name: ðŸ“¤ Commit and push documentation updates
        if: steps.check-changes.outputs.status == 'changed'
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "SCRIBE Bot"
          git add README.md AGENTS.md CITYMAP.md HELP.md INDEX.md
          git commit -m "chore: Auto-generate documentation (standalone)

Generated by scripts/generate_docs.py:
- README.md (project overview)
- AGENTS.md (agent registry)
- CITYMAP.md (system architecture)
- HELP.md (system help)
- INDEX.md (documentation index)

[skip ci]"
          git push

      - name: âœ… Documentation Status
        run: |
          echo "ðŸ“Š Documentation generation complete"
          echo "Generated via standalone scripts (no kernel dependency)"
          echo "Files updated:"
          echo "  - README.md"
          echo "  - AGENTS.md"
          echo "  - CITYMAP.md"
          echo "  - HELP.md"
          echo "  - INDEX.md"
