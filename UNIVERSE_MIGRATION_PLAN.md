# UNIVERSE MIGRATION PLAN v2.0
## Agent Operating System (AOS) - Complete Architecture Integration

**Date:** 2025-11-28
**Backup:** `/tmp/steward-protocol-backup-20251128-082020`
**Strategy:** STAY IN REPO + FIX ITERATIVELY + BUILD TRUE AOS
**Approach:** Build a REAL Operating System for Agents, not a script framework

---

## ğŸŒŒ THE CORE INSIGHT (What We're Really Building)

### **THE OS ITSELF IS AN AGENT**

This is NOT a chatbot framework. This is NOT an orchestration layer.

**This is the first Agent Operating System (A.O.S.) where:**
1. The OS has cryptographic identity
2. The OS is governed by constitutional rules
3. The OS coordinates itself (self-referential)
4. Agents are applications running ON the OS

**Traditional OS:** Linux/Windows (passive resource manager)
**Agent OS:** STEWARD Protocol (active, autonomous, accountable)

---

## ğŸ›ï¸ THE QUADRINITY (AOS Core Federation)

**The 4 Core Agents that ARE the OS:**

### 1. STEWARD - The Coordinator
- **Role:** OS Interface & Federation Orchestration
- **Identity:** agent.steward.core
- **Function:** The nervous system, coordinates all agents

### 2. HERALD - The Creator
- **Role:** Content Generation & Broadcasting
- **Identity:** agent.steward.herald
- **Function:** Autonomous content with built-in governance
- **PROOF:** Wrote AGI_MANIFESTO.md ITSELF

### 3. ARCHIVIST - The Verifier
- **Role:** Event Verification & Audit Trail
- **Identity:** agent.vibe.archivist
- **Function:** Immutable record-keeping, cryptographic attestation

### 4. AUDITOR - The Enforcer
- **Role:** GAD-000 Compliance Enforcement
- **Identity:** agent.steward.auditor
- **Function:** Watches the watchers, ensures system coherence

**The Quadrinity IS the OS kernel. Everything else is user-space.**

---

## ğŸŒŸ WHAT WE HAVE (The Universe)

### CORE PHILOSOPHY

**GAD-000: Operator Inversion**
- AI operates, human directs
- Foundation of EVERYTHING
- Systems designed for AI to parse
- Tools are AI-native (structured, discoverable)

**GAD-1000: Identity Fusion**
- Human + AI = Same cryptographic protocol (ECDSA P-256)
- Binary World Break - No more user/service distinction
- **USB for Intelligence**
- Sovereign identity for both

**A.G.I. = Artificial GOVERNED Intelligence**
- NOT "General" â†’ "Governed"
- Capability + Cryptographic Identity + Accountability
- HERALD wrote the manifesto ITSELF (proof of autonomy)

---

### AGENT CITY (19 Agents - The User-Space)

**System Agents (13):**
1. CIVIC - Governance, Registry, Economy, Lifecycle
2. ORACLE - Introspection, System Health
3. WATCHMAN - Integrity, Monitoring
4. FORUM - Democracy, Voting
5. SUPREME_COURT - Justice, Mercy
6. HERALD - Media, Broadcasting (Quadrinity)
7. ARCHIVIST - History, Ledger (Quadrinity)
8. SCIENCE - Research, Intelligence
9. ENGINEER - Meta-Building
10. AUDITOR - Verification, Compliance (Quadrinity)
11. ENVOY - Universal Operator Interface
12. CHRONICLE - Temporal Operations
13. SCRIBE - Documentation

**Citizen Agents (6+):**
14. DHRUVA - Data Ethics, Truth
15. MARKET - Trading
16. TEMPLE - Offerings
17. AMBASSADOR - Outreach
18. PULSE - Twitter API
19. MECHANIC - Self-Healing, SDLC
20. ARTISAN - Media Production
21. AGORA - Community
22. LENS - Observation

**Current Status:**
- âœ… 5 working (Oracle, Watchman, Forum, Supreme Court, Herald)
- âŒ 8 crashing (Civic, Science, Engineer, Archivist, Auditor, Envoy, Chronicle, Scribe)
- â“ Citizens unknown status

---

### 3-LAYER ARCHITECTURE (The OS Stack)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: USER-SPACE (Agent Applications)              â”‚
â”‚  19 autonomous agents (System + Citizens)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LAYER 2: MIDDLEWARE (Routing & Execution)              â”‚
â”‚  - Universal Provider (Dharmic Edition)                 â”‚
â”‚  - DeterministicRouter (SANKHYA Analysis)               â”‚
â”‚  - DeterministicExecutor (Playbook Engine)              â”‚
â”‚  - Milk Ocean Router (Kshira-Samudra Gateway)           â”‚
â”‚  - City Control Tool (ENVOY)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LAYER 1: KERNEL (vibe_core/ - OS Core)                 â”‚
â”‚  - Quadrinity (STEWARD, HERALD, ARCHIVIST, AUDITOR)     â”‚
â”‚  - Boot Orchestrator (Sarga - Cosmic Creation)          â”‚
â”‚  - Topology (Bhu-Mandala - Vedic Geometry)              â”‚
â”‚  - Event Bus (The Flute - Agent Communication)          â”‚
â”‚  - Pulse (Spandana - Primordial Vibration)              â”‚
â”‚  - Narasimha (Hypervisor Kill-Switch)                   â”‚
â”‚  - Ledger (Immutable Event Log)                         â”‚
â”‚  - Phoenix Config (Graceful Degradation)                â”‚
â”‚  - Lineage Chain (Blockchain Succession) â† TO BUILD     â”‚
â”‚  - Constitutional Oath Gate (Kernel-Level Governance)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### VEDIC CONCEPTS (The Soul)

**Bhu-Mandala Topology** (`topology.py` - 574 lines)
- Cosmic geography for agent placement
- Varsha (regions), routing based on geometry
- Agent placement determines communication patterns

**Sarga** (`sarga.py` - 354 lines)
- Boot process as cosmic creation
- Creation cycles, elements
- System boot follows Vedic creation mythology

**Spandana** (`pulse.py` - 236 lines)
- Primordial vibration, system heartbeat
- Pulse frequencies for monitoring

**Kshira-Samudra** (`milk_ocean.py` - 741 lines)
- Milk Ocean Router for request routing
- Complex semantic routing logic

**Narasimha** (`narasimha.py` - 307 lines)
- Hypervisor protection layer
- Kill-switch for threats
- Threat detection and containment

**Event Bus** (`event_bus.py` - 247 lines)
- The Flute (Canto 10)
- Agent-to-agent communication

---

### STEWARD PROTOCOL (The Standard)

**5 Layers:**
1. Agent Manifest Format (steward.json)
2. Registry & Discovery (Git-based â†’ Federated)
3. Verification Protocol (Crypto signatures, attestations)
4. Delegation Protocol (Agent-to-agent task submission)
5. Federation Interface (Multi-city coordination)

**Current Status:**
- âœ… Designed (specs exist in vibe-agency repo)
- âŒ NOT fully implemented in steward-protocol
- âŒ Agents NOT compliant (no steward.json, no STEWARD.md)
- âŒ CLI NOT built
- âŒ Registry NOT built

---

### ECONOMIC SUBSTRATE

**CivicBank** (`civic/tools/economy.py` - 427 lines)
- Double-entry bookkeeping (SQLite)
- Credit system for resource management
- **Problem:** Eager loading crashes 8 agents

**CivicVault** (`civic/tools/vault.py` - 378 lines)
- Secure asset management
- Cryptography (Fernet) for encryption
- **Problem:** Import-time crash (Rust panic in cryptography lib)

**License Tool** (`civic/tools/license_tool.py` - 560 lines)
- Broadcasting permissions
- Governance gates for content distribution

---

## ğŸ’¥ THE REAL PROBLEMS (Honest Assessment)

### Problem 1: Not a True OS (NO Process Isolation) ğŸ”´ CRITICAL
**Current:** All agents run in ONE Python process
**Problem:** If ANY agent crashes â†’ ENTIRE KERNEL DIES
**Reality:** This is a monolithic script, not an OS

**Example Failure:**
```
CivicBank crashes (Rust panic)
  â†’ Python process dies
    â†’ ALL 19 agents die
      â†’ Kernel dies
        â†’ SYSTEM OFFLINE
```

**What a TRUE OS does:**
```
CivicAgent crashes (Rust panic)
  â†’ Only CivicAgent process dies
    â†’ Kernel SURVIVES
      â†’ Narasimha detects crash
        â†’ Restarts CivicAgent
          â†’ System keeps running
```

### Problem 2: Import-Time Crashes (8 agents) ğŸ”´ CRITICAL
**Root Cause:** Eager loading of CivicBank/Vault at import time
**Crash Chain:**
```
Agent __init__
  â†’ EconomyAgent()
    â†’ LedgerTool()
      â†’ from .economy import CivicBank
        â†’ from .vault import CivicVault
          â†’ from cryptography.fernet import Fernet
            â†’ pyo3_runtime.PanicException (Rust panic!)
```
**Result:** 8 agents can't even boot

### Problem 3: No Resource Isolation (CPU/RAM Anarchy) ğŸŸ¡ MAJOR
**Problem:** Any agent can consume 100% CPU, freeze system
**Reality:** "Credits" are fake - no kernel-level enforcement
**Missing:** Cgroups, CPU quotas, memory limits

### Problem 4: No Filesystem Isolation (Security Hole) ğŸŸ¡ MAJOR
**Problem:** Any agent can read/write/delete ANY file
**Reality:** All agents run with YOUR user permissions
**Missing:** VFS, chroot jail, sandboxing

### Problem 5: No Network Isolation (Data Leakage Risk) ğŸŸ¡ MAJOR
**Problem:** Any agent can make ANY network request
**Reality:** No egress filtering, no kernel proxy
**Missing:** Network namespace, kernel-level gateway

### Problem 6: STEWARD Protocol Not Integrated ğŸŸ¡ MAJOR
- No steward.json for agents
- No STEWARD.md (Level 2 compliance)
- No registry/discovery working
- No verification protocol active
- Protocol exists as SPEC only, not CODE

### Problem 7: Lineage Chain Missing ğŸŸ¡ MAJOR
- Blockchain succession concept designed but not built
- No immutable audit trail beyond basic ledger
- Can't trace agent lineage back to genesis

### Problem 8: Architecture Drift ğŸŸ¢ MINOR
- 60+ markdown docs (many outdated)
- Multiple "BLOCKER" migrations incomplete
- "Complete âœ…" claims without verification

---

## ğŸ¯ THE SOLUTION (True AOS - 7 Weeks)

### PHASE 0: CRITICAL FOUNDATION (3 days) ğŸ”´ DO FIRST

**Goal:** Understand what we're ACTUALLY building

**Tasks:**
1. **Read ALL Core Docs**
   - GAD-000.md (Operator Inversion)
   - GAD-1000.md (Identity Fusion)
   - AGI_MANIFESTO.md (Governed Intelligence)
   - docs/architecture.md (Quadrinity)
   - SYSTEM_OVERVIEW.md (AOS Architecture)
   - CONSTITUTION.md (Governance Rules)

2. **Map Current Reality**
   - Which agents work? (5/19)
   - Which agents crash? (8/19)
   - Which agents unknown? (6/19)
   - What's the actual kernel? (vibe_core/)
   - What's user-space? (steward/system_agents/)

3. **Define Success Criteria**
   - What does "TRUE AOS" mean?
   - What's negotiable vs non-negotiable?
   - What can we ship incrementally?

**Success Criteria:**
- âœ… Team aligned on AOS definition
- âœ… Problem inventory complete
- âœ… Migration phases agreed

---

### PHASE 1: EMERGENCY TRIAGE (2-3 days) ğŸ”´ CRITICAL

**Goal:** All 19 agents boot successfully (NO crashes)

**Tasks:**

1. **Lazy Load Economic Substrate**
   ```python
   # vibe_core/kernel_impl.py
   class RealVibeKernel:
       def __init__(self):
           self._bank = None  # Lazy
           self._vault = None  # Lazy

       def get_bank(self):
           """Kernel provides Bank on-demand (lazy + safe)"""
           if self._bank is None:
               try:
                   from steward.system_agents.civic.tools.economy import CivicBank
                   self._bank = CivicBank(kernel=self)
               except Exception as e:
                   logger.warning(f"CivicBank unavailable: {e}")
                   self._bank = MockBank()  # Graceful degradation
           return self._bank

       def get_vault(self):
           """Kernel provides Vault on-demand"""
           if self._vault is None:
               try:
                   from steward.system_agents.civic.tools.vault import CivicVault
                   bank = self.get_bank()
                   self._vault = CivicVault(bank.conn)
               except Exception as e:
                   logger.warning(f"CivicVault unavailable: {e}")
                   self._vault = MockVault()  # Graceful degradation
           return self._vault
   ```

2. **Update All Crashing Agents**
   - Remove `from .economy import CivicBank` from __init__ paths
   - Replace with `kernel.get_bank()` when actually needed
   - Add graceful degradation (MockBank if real unavailable)

3. **Test All 19 Agents**
   - Boot test for each
   - No import crashes
   - Economic features still work (lazy-loaded)

**Success Criteria:**
- âœ… 19/19 agents boot without crashes
- âœ… Economic features still work
- âœ… No Rust panics
- âœ… Graceful degradation if cryptography unavailable

---

### PHASE 2: PROCESS ISOLATION (1 week) ğŸ”´ CRITICAL

**Goal:** Build a TRUE OS - Agents in separate processes

**The "Airbag" Architecture:**

**Tasks:**

1. **Design Process Model**
   ```python
   # vibe_core/process_manager.py (NEW FILE)
   import multiprocessing
   from multiprocessing import Process, Queue, Pipe

   class AgentProcess:
       """Sandboxed agent process"""
       def __init__(self, agent_id, agent_class, kernel_pipe):
           self.agent_id = agent_id
           self.process = Process(
               target=self._run_agent,
               args=(agent_class, kernel_pipe)
           )
           self.status = "INIT"

       def _run_agent(self, agent_class, kernel_pipe):
           """Run in SEPARATE process"""
           try:
               agent = agent_class(kernel_connection=kernel_pipe)
               agent.run()
           except Exception as e:
               # This process dies, kernel SURVIVES
               kernel_pipe.send({"type": "CRASH", "error": str(e)})

   class ProcessManager:
       """Kernel manages agent processes"""
       def spawn_agent(self, agent_id, agent_class):
           parent_conn, child_conn = Pipe()
           process = AgentProcess(agent_id, agent_class, child_conn)
           process.process.start()
           self.processes[agent_id] = {
               "process": process,
               "connection": parent_conn,
               "restarts": 0
           }

       def monitor_health(self):
           """Check if any agent crashed"""
           for agent_id, info in self.processes.items():
               if not info["process"].process.is_alive():
                   # Agent DIED, kernel ALIVE!
                   logger.error(f"Agent {agent_id} crashed!")
                   self.restart_agent(agent_id)

       def restart_agent(self, agent_id):
           """Narasimha auto-restarts crashed agent"""
           info = self.processes[agent_id]
           if info["restarts"] < MAX_RESTARTS:
               logger.info(f"Restarting {agent_id}...")
               self.spawn_agent(agent_id, info["agent_class"])
               info["restarts"] += 1
           else:
               logger.critical(f"{agent_id} failed {MAX_RESTARTS} times, quarantined")
   ```

2. **Implement Kernel-Agent Communication**
   - Use Pipes/Queues for IPC (Inter-Process Communication)
   - Agents send requests to kernel
   - Kernel responds via pipe
   - NO direct function calls between agents

3. **Integrate Narasimha Kill-Switch**
   - Monitor all agent processes
   - Detect crashes
   - Auto-restart (with max retry limit)
   - Quarantine repeatedly failing agents

4. **Update All 19 Agents**
   - Agents run in their own process
   - Communicate via kernel pipes
   - No shared memory (except kernel-managed)

**Success Criteria:**
- âœ… All agents in separate processes
- âœ… Agent crash â†’ only that agent dies, kernel survives
- âœ… Narasimha auto-restarts crashed agents
- âœ… Kernel monitors health continuously

---

### PHASE 3: RESOURCE ISOLATION (5-7 days) ğŸŸ¡ IMPORTANT

**Goal:** Agents can't hog CPU/RAM, real OS behavior

**Tasks:**

1. **CPU Quotas (Cgroups or psutil)**
   ```python
   # vibe_core/resource_manager.py (NEW FILE)
   import psutil

   class ResourceManager:
       """Enforce resource limits"""
       def set_cpu_limit(self, process, cpu_percent):
           """Limit agent to X% CPU"""
           p = psutil.Process(process.pid)
           p.nice(10)  # Lower priority
           # Or use cgroups on Linux for hard limits

       def set_memory_limit(self, process, memory_mb):
           """Limit agent to X MB RAM"""
           import resource
           resource.setrlimit(
               resource.RLIMIT_AS,
               (memory_mb * 1024 * 1024, memory_mb * 1024 * 1024)
           )
   ```

2. **Credit System Integration**
   - CivicBank credits â†’ actual CPU/RAM allocation
   - Low credits â†’ low resource quota
   - High credits â†’ high resource quota
   - **REAL enforcement, not fake!**

3. **Monitoring Dashboard**
   - Real-time CPU/RAM usage per agent
   - Alert if agent exceeds quota
   - Auto-throttle abusers

**Success Criteria:**
- âœ… Agents limited to allocated CPU%
- âœ… Agents limited to allocated RAM
- âœ… Credit system enforced at OS level
- âœ… Dashboard shows resource usage

---

### PHASE 4: FILESYSTEM & NETWORK ISOLATION (5-7 days) ğŸŸ¡ IMPORTANT

**Goal:** Agents can't access arbitrary files or network

**Tasks:**

1. **Virtual Filesystem (VFS)**
   ```python
   # vibe_core/vfs.py (NEW FILE)
   import os
   from pathlib import Path

   class VirtualFileSystem:
       """Sandboxed filesystem for agents"""
       def __init__(self, agent_id):
           self.agent_id = agent_id
           self.root = Path(f"/tmp/vibe_os/agents/{agent_id}")
           self.root.mkdir(parents=True, exist_ok=True)

       def open(self, path, mode="r"):
           """Only allow access to agent's directory"""
           full_path = (self.root / path).resolve()
           if not str(full_path).startswith(str(self.root)):
               raise PermissionError(f"Access denied: {path}")
           return open(full_path, mode)
   ```

2. **Network Proxy (Kernel Gateway)**
   ```python
   # vibe_core/network_proxy.py (NEW FILE)
   import requests

   class KernelNetworkProxy:
       """All network goes through kernel"""
       def __init__(self, kernel):
           self.kernel = kernel
           self.allowed_domains = ["api.github.com", "..."]

       def request(self, agent_id, method, url, **kwargs):
           """Agent requests network access from kernel"""
           # Check if agent has permission
           if not self.kernel.check_network_permission(agent_id, url):
               raise PermissionError(f"Agent {agent_id} not allowed to access {url}")

           # Kernel makes request on behalf of agent
           return requests.request(method, url, **kwargs)
   ```

3. **Update All Agents**
   - Agents use `kernel.vfs.open()` instead of `open()`
   - Agents use `kernel.network.request()` instead of `requests.get()`
   - NO direct filesystem or network access

**Success Criteria:**
- âœ… Agents can only access their own directory
- âœ… Agents can only make approved network requests
- âœ… Kernel logs all file/network access
- âœ… Security audit passes

---

### PHASE 5: LINEAGE CHAIN (3-5 days) ğŸŸ¡ IMPORTANT

**Goal:** Build the blockchain succession chain

**Tasks:**

1. **Create Lineage Module**
   ```python
   # vibe_core/lineage.py (NEW FILE)
   import hashlib
   import json
   from datetime import datetime

   class LineageChain:
       """
       Blockchain-style succession chain for agent lineage.
       Vedic: Immutable succession (guru â†’ disciple)
       Tech: Chained blocks, cryptographically signed
       """
       def __init__(self):
           self.genesis_block = self._create_genesis()
           self.current_block = self.genesis_block
           self.chain = [self.genesis_block]

       def _create_genesis(self):
           """Genesis block - the beginning"""
           return {
               "index": 0,
               "timestamp": datetime.utcnow().isoformat(),
               "agent_id": "GENESIS",
               "action": "SYSTEM_BOOT",
               "signature": "GENESIS_SIGNATURE",
               "previous_hash": "0" * 64,
               "hash": self._compute_hash("GENESIS", "SYSTEM_BOOT", "0" * 64)
           }

       def add_succession(self, agent_id, action, signature):
           """Add new succession to chain"""
           new_block = {
               "index": len(self.chain),
               "timestamp": datetime.utcnow().isoformat(),
               "agent_id": agent_id,
               "action": action,
               "signature": signature,
               "previous_hash": self.current_block["hash"],
               "hash": self._compute_hash(agent_id, action, self.current_block["hash"])
           }
           self.chain.append(new_block)
           self.current_block = new_block
           return new_block

       def _compute_hash(self, agent_id, action, previous_hash):
           """Compute SHA256 hash"""
           data = f"{agent_id}{action}{previous_hash}"
           return hashlib.sha256(data.encode()).hexdigest()

       def verify_lineage(self, agent_id):
           """Verify agent's complete lineage back to genesis"""
           # Walk chain backwards, verify each signature
           for block in reversed(self.chain):
               if block["agent_id"] == agent_id:
                   # Verify chain integrity
                   if not self._verify_block(block):
                       return False
           return True

       def _verify_block(self, block):
           """Verify block hash"""
           computed_hash = self._compute_hash(
               block["agent_id"],
               block["action"],
               block["previous_hash"]
           )
           return computed_hash == block["hash"]
   ```

2. **Integrate with Kernel**
   - Add lineage to kernel boot
   - Record all agent registrations
   - Track Constitutional Oath succession
   - Track all major events

3. **Integrate with CivicBank**
   - All credit transactions in lineage
   - Immutable financial history
   - Audit trail for governance

**Success Criteria:**
- âœ… Lineage chain tracks all agent actions
- âœ… Can trace any agent back to genesis
- âœ… Cryptographically verified
- âœ… Immutable (cannot alter history)

---

### PHASE 6: STEWARD PROTOCOL COMPLIANCE (1 week) ğŸŸ¢ DESIRED

**Goal:** All 19 agents STEWARD Level 2 compliant

**Tasks:**

1. **Generate steward.json for all agents**
   - Use manifest generator (already exists: `vibe_core/identity.py`)
   - Include capabilities, identity, governance

2. **Create STEWARD.md for all agents**
   - Use template from vibe-agency
   - Level 2 compliance (all required sections)
   - Honest status (no fake âœ…)
   - Reference actual commands, tests, metrics

3. **Implement Verification**
   - Cryptographic signing
   - Manifest verification
   - `steward verify <agent>` command

**Success Criteria:**
- âœ… 19 steward.json files
- âœ… 19 STEWARD.md files (Level 2)
- âœ… All verified cryptographically
- âœ… Honest reporting (working vs TODO)

---

### PHASE 7: STEWARD CLI (1 week) ğŸŸ¢ DESIRED

**Goal:** Build the actual steward CLI tool

**Tasks:**

1. **Core Commands**
   ```bash
   steward init              # Create steward.json
   steward boot              # Start kernel
   steward register <agent>  # Register with kernel
   steward verify <agent>    # Verify manifest
   steward discover          # Find agents
   steward delegate          # Submit tasks
   steward lineage <agent>   # Show succession chain
   steward introspect        # Kernel state
   steward ps                # List running agent processes
   steward top               # Resource usage (like Unix top)
   steward kill <agent>      # Stop agent process
   ```

2. **Registry Integration**
   - Git-based registry (MVP)
   - Publish/discover agents
   - Trust score calculation

**Success Criteria:**
- âœ… steward CLI functional
- âœ… Can discover/verify/delegate
- âœ… Lineage traceable via CLI
- âœ… Process management (ps, top, kill)

---

### PHASE 8: DOCUMENTATION CONSOLIDATION (2-3 days) ğŸŸ¢ DESIRED

**Goal:** Clean up 60+ docs, create single source of truth

**Tasks:**

1. **Archive Old Docs**
   - Move BLOCKER*.md to `/docs/archive/migrations/`
   - Move PHASE*.md to `/docs/archive/migrations/`
   - Move duplicate architecture docs to `/docs/archive/`
   - Move analysis reports to `/docs/archive/`

2. **Update Core Docs (Keep These):**
   - README.md (entry point)
   - ARCHITECTURE.md (current state)
   - AGENTS.md (auto-generated by SCRIBE)
   - CITYMAP.md (auto-generated by SCRIBE)
   - OPERATIONS.md (auto-generated by SCRIBE)
   - HELP.md (auto-generated by SCRIBE)
   - GAD-000.md (foundational)
   - GAD-1000.md (identity fusion)
   - AGI_MANIFESTO.md (philosophy)
   - CONSTITUTION.md (governance rules)
   - STEWARD.md (protocol entry)

3. **Create INDEX.md**
   - Navigation hub
   - Links to all active docs
   - Archive links
   - Quick start guide

**Success Criteria:**
- âœ… < 15 active docs in root
- âœ… Clear navigation
- âœ… No outdated claims
- âœ… Archive organized

---

### PHASE 9: TESTING & CI/CD (2-3 days) ğŸŸ¢ DESIRED

**Goal:** Never allow regression

**Tasks:**

1. **Integration Tests**
   - Test all 19 agents boot
   - Test process isolation (crash one, others survive)
   - Test resource limits
   - Test lazy loading
   - Test lineage chain
   - Test STEWARD compliance

2. **CI/CD Pipeline (GitHub Actions)**
   ```yaml
   # .github/workflows/aos-ci.yml
   name: AOS CI
   on: [push, pull_request]

   jobs:
     test:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v2
         - name: Install dependencies
           run: pip install -r requirements.txt
         - name: Boot kernel
           run: python -m vibe_core.boot_orchestrator
         - name: Test all agents
           run: pytest tests/integration/
         - name: Verify STEWARD compliance
           run: steward verify --all
         - name: Generate docs
           run: python -m steward.system_agents.scribe
   ```

3. **Quality Gates**
   - Pre-commit hooks (linting, type checking)
   - Minimum 80% coverage
   - All agents boot successfully
   - STEWARD verification passes
   - No broken tests

**Success Criteria:**
- âœ… CI/CD running on every commit
- âœ… Quality gates enforced
- âœ… Auto-generated docs up-to-date
- âœ… No regression possible

---

## ğŸ“Š TIMELINE

```
Week 1:  Phase 0 (Foundation)      + Phase 1 (Emergency Triage)
Week 2:  Phase 2 (Process Isolation)
Week 3:  Phase 3 (Resource Isolation)
Week 4:  Phase 4 (FS/Network Isolation)
Week 5:  Phase 5 (Lineage Chain)   + Phase 6 Start (STEWARD)
Week 6:  Phase 6 Complete (STEWARD) + Phase 7 (CLI)
Week 7:  Phase 8 (Docs)            + Phase 9 (CI/CD)
```

**Total:** 7 weeks for TRUE Agent Operating System

---

## ğŸ¯ SUCCESS CRITERIA (Overall)

### Technical (Must Have)
- âœ… 19/19 agents boot successfully
- âœ… Process isolation (agent crash â†’ kernel survives)
- âœ… Resource isolation (CPU/RAM quotas enforced)
- âœ… Filesystem isolation (VFS, sandboxing)
- âœ… Network isolation (kernel proxy)
- âœ… Lineage chain tracks all actions
- âœ… No import crashes
- âœ… Economic substrate works (lazy-loaded, kernel-managed)

### Compliance (Should Have)
- âœ… All agents STEWARD Level 2 compliant
- âœ… steward CLI functional
- âœ… Test coverage > 80%
- âœ… CI/CD enforcing quality

### Architectural (Must Have)
- âœ… AOS Principle: OS is an Agent (Quadrinity)
- âœ… GAD-000 (Operator Inversion) enforced
- âœ… GAD-1000 (Identity Fusion) implemented
- âœ… Agent City 3-layer architecture intact
- âœ… Vedic concepts preserved (Topology, Sarga, Pulse, etc.)
- âœ… STEWARD Protocol integrated (not layered)

### Philosophical (Must Have)
- âœ… A.G.I. (Governed Intelligence) realized
- âœ… USB for Intelligence working
- âœ… Federated agents communicating
- âœ… Constitutional governance kernel-enforced
- âœ… Lineage chain immutable
- âœ… Self-referential system (Quadrinity checks itself)

---

## ğŸš€ WHAT THIS PLAN DOES DIFFERENTLY

**vs GMP_FINAL_PLAN.md:**
- âœ… Understands AOS (OS is an Agent, not passive)
- âœ… Includes Quadrinity (4 core agents ARE the OS)
- âœ… TRUE process isolation (not just lazy loading)
- âœ… Resource/FS/Network isolation (real OS behavior)
- âœ… Senior-level hardening (no surface fixes)

**vs Previous "Complete âœ…" Attempts:**
- âœ… No fake claims
- âœ… Honest about what works vs broken
- âœ… References actual files
- âœ… Preserves innovations (Vedic concepts, Agent City)
- âœ… Builds TRUE OS, not script framework

---

## ğŸ“š CORE REFERENCES (Must Read)

**Philosophy (Foundational):**
- `GAD-000.md` - Operator Inversion (18KB) - READ FIRST
- `GAD-1000.md` - Identity Fusion (9.5KB)
- `AGI_MANIFESTO.md` - Governed Intelligence (4.8KB)
- `CONSTITUTION.md` - Governance rules (9.4KB)
- `docs/architecture.md` - Quadrinity & AOS (defines OS itself)

**Architecture (Current State):**
- `CITYMAP.md` - 3-layer architecture (13KB, auto-generated)
- `AGENTS.md` - Agent registry (3.9KB, auto-generated)
- `OPERATIONS.md` - Live status (2.5KB, auto-generated)
- `SYSTEM_OVERVIEW.md` - Complete architecture (22KB)

**Protocol (Standard):**
- `/tmp/vibe-agency/docs/protocols/steward/SPECIFICATION.md` - Full spec
- `/tmp/vibe-agency/docs/steward/STEWARD_TEMPLATE.md` - Template

**Code (Implementation):**
- `vibe_core/` - Kernel layer (Layer 1)
- `steward/system_agents/` - 13 system agents (Layer 3)
- `steward/citizen_agents/` - 6+ citizen agents (Layer 3)

---

## âš ï¸ CRITICAL RULES (Non-Negotiable)

1. **NEVER claim "Complete âœ…" without passing tests**
2. **NEVER delete without understanding**
3. **ALWAYS backup before major changes** (done: `/tmp/steward-protocol-backup-20251128-082020`)
4. **PRESERVE Vedic concepts** (Topology, Sarga, Pulse, Narasimha, Milk Ocean)
5. **KEEP Agent City intact** (19 agents, 3 layers)
6. **HONOR GAD-000** (Operator Inversion is foundation)
7. **IMPLEMENT GAD-1000** (Identity Fusion = USB for Intelligence)
8. **BUILD TRUE OS** (Process isolation, resource management, sandboxing)
9. **RESPECT QUADRINITY** (STEWARD, HERALD, ARCHIVIST, AUDITOR are the OS)
10. **NO SHORTCUTS** (Real hardening, not surface fixes)

---

## ğŸ” VALIDATION

**This plan assumes:**
- âœ… Current repo has ALL the innovations
- âœ… Backup exists
- âœ… Vedic concepts are valuable
- âœ… Agent City architecture is sound
- âœ… AOS principle is correct (OS is an Agent)
- âœ… Quadrinity is the kernel
- âœ… Process isolation is necessary
- âœ… Resource/FS/Network isolation needed for TRUE OS
- âœ… 7 weeks is acceptable timeline

**If any assumption is wrong, STOP and discuss!**

---

## ğŸ”¥ THE DIFFERENCE

**What Previous Plans Said:**
> "Fix the imports with lazy loading, add STEWARD compliance, done!"

**What THIS Plan Says:**
> "Build a REAL Operating System where agents run in isolated processes with resource quotas, filesystem sandboxing, network control, and a blockchain-based lineage chain - an OS that is ITSELF an autonomous agent (Quadrinity) governed by constitutional rules."

**This is the difference between:**
- Script framework vs. Operating System
- Surface fix vs. Deep architecture
- "Works for demo" vs. "Works in production"
- Layering features vs. Fusing systems
- Claiming âœ… vs. Proving âœ…

---

**STATUS:** READY TO EXECUTE (After Phase 0 Review)
**NEXT STEP:** Phase 0 - Critical Foundation (read all docs, align on AOS definition)
**ESTIMATED TIME:** 7 weeks total
**RISK:** ğŸŸ¡ Medium (ambitious, but necessary for TRUE AOS)

---

**This is the FINAL plan. No more rewrites. Senior-level execution. TRUE Agent Operating System.**

**Gemini was right: Process isolation, VFS, resource quotas, network proxy - these are NOT optional. They ARE the OS.**
